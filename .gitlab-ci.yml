build-docker-image:
  script:
    - echo "Building docker image..."
    - sudo docker compose -f reats/config/docker-compose.yaml up --build -d
  rules:
    - if: $CI_PIPELINE_SOURCE == 'merge_request_event'
  stage: build-docker-image


run-unit-tests:
  script:
    - echo "Running unit tests..."
    - docker exec -t django_app pytest -x -v
  rules:
    - if: $CI_PIPELINE_SOURCE == 'merge_request_event'
  stage: run-unit-tests

stages:
  - build-docker-image
  - run-unit-tests